{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/25LP5292/Desktop/Q/lib/prisma.ts"],"sourcesContent":["import { PrismaPg } from \"@prisma/adapter-pg\";\nimport { PrismaClient } from \"@prisma/client\";\nimport pg from \"pg\";\n\nconst { Pool } = pg;\nconst connectionString = process.env.DATABASE_URL;\nconst pool = new Pool({ connectionString });\nconst adapter = new PrismaPg(pool);\n\nconst globalForPrisma = global as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\n// Use 'export const' for a named export\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    adapter,\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,EAAE,IAAI,EAAE,GAAG,wJAAE;AACnB,MAAM;AACN,MAAM,OAAO,IAAI,KAAK;IAAE;AAAiB;AACzC,MAAM,UAAU,IAAI,yKAAQ,CAAC;AAE7B,MAAM;AAKC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf;AACF;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///Users/25LP5292/Desktop/Q/lib/openai.ts"],"sourcesContent":["import { GoogleGenerativeAI } from \"@google/generative-ai\";\n\nif (!process.env.API_KEY) {\n  throw new Error(\"GEMINI_API_KEY is missing\");\n}\n\nexport const genAI = new GoogleGenerativeAI(process.env.API_KEY);\nexport const geminiModel = genAI.getGenerativeModel({\n  model: \"gemini-2.5-flash\",\n});\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA;;AAIO,MAAM,QAAQ,IAAI,sLAAkB;AACpC,MAAM,cAAc,MAAM,kBAAkB,CAAC;IAClD,OAAO;AACT"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///Users/25LP5292/Desktop/Q/app/api/summarize/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { auth, currentUser } from \"@clerk/nextjs/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { genAI } from \"@/lib/openai\";\n\nexport async function POST(req: Request) {\n  try {\n    const { userId } = await auth();\n    const user = await currentUser();\n\n    if (!userId || !user) {\n      return new NextResponse(\"Unauthorized\", { status: 401 });\n    }\n\n    const body = await req.json();\n    const { title, content, maxLength = 150 } = body;\n\n    if (!title || !content) {\n      return new NextResponse(\"Missing fields\", { status: 400 });\n    }\n\n    // 1. Хэрэглэгчийг шалгах/үүсгэх (Upsert)\n    const dbUser = await prisma.user.upsert({\n      where: { clerkId: userId },\n      update: {},\n      create: {\n        clerkId: userId,\n        email: user.emailAddresses[0].emailAddress,\n        name: `${user.firstName || \"\"} ${user.lastName || \"\"}`.trim(),\n      },\n    });\n\n    // 2. Gemini Model (Нэрийг зөв тогтмол хувилбараар ашиглах)\n    const model = genAI.getGenerativeModel({\n      model: \"gemini-2.5-flash\",\n    });\n\n    const prompt = `Доорх нийтлэлийг ${maxLength} үгнээс хэтрэхгүйгээр монгол хэл дээр хураангуйлж бич:\\n\\n${content}`;\n\n    const result = await model.generateContent(prompt);\n    const response = await result.response;\n    const summary = response.text();\n\n    if (!summary) {\n      throw new Error(\"AI-аас хариу ирсэнгүй\");\n    }\n\n    // 3. Өгөгдлийн санд хадгалах\n    const article = await prisma.article.create({\n      data: {\n        title,\n        content,\n        summary,\n        userId: dbUser.id,\n      },\n    });\n\n    return NextResponse.json(article, { status: 201 });\n  } catch (error: unknown) {\n    // TypeScript-ийн алдааг (err: any) биш (error: unknown) гэж засав\n    console.error(\"SUMMARIZE ERROR:\", error);\n\n    let message = \"Сервер дээр алдаа гарлаа\";\n    if (error instanceof Error) {\n      message = error.message;\n    }\n\n    if (message.includes(\"API_KEY_INVALID\")) {\n      return new NextResponse(\"Gemini API түлхүүр буруу байна\", {\n        status: 500,\n      });\n    }\n\n    return new NextResponse(`Алдаа: ${message}`, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,6LAAI;QAC7B,MAAM,OAAO,MAAM,IAAA,2MAAW;QAE9B,IAAI,CAAC,UAAU,CAAC,MAAM;YACpB,OAAO,IAAI,gJAAY,CAAC,gBAAgB;gBAAE,QAAQ;YAAI;QACxD;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,GAAG,EAAE,GAAG;QAE5C,IAAI,CAAC,SAAS,CAAC,SAAS;YACtB,OAAO,IAAI,gJAAY,CAAC,kBAAkB;gBAAE,QAAQ;YAAI;QAC1D;QAEA,yCAAyC;QACzC,MAAM,SAAS,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACtC,OAAO;gBAAE,SAAS;YAAO;YACzB,QAAQ,CAAC;YACT,QAAQ;gBACN,SAAS;gBACT,OAAO,KAAK,cAAc,CAAC,EAAE,CAAC,YAAY;gBAC1C,MAAM,GAAG,KAAK,SAAS,IAAI,GAAG,CAAC,EAAE,KAAK,QAAQ,IAAI,IAAI,CAAC,IAAI;YAC7D;QACF;QAEA,2DAA2D;QAC3D,MAAM,QAAQ,wHAAK,CAAC,kBAAkB,CAAC;YACrC,OAAO;QACT;QAEA,MAAM,SAAS,CAAC,iBAAiB,EAAE,UAAU,0DAA0D,EAAE,SAAS;QAElH,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;QAC3C,MAAM,WAAW,MAAM,OAAO,QAAQ;QACtC,MAAM,UAAU,SAAS,IAAI;QAE7B,IAAI,CAAC,SAAS;YACZ,MAAM,IAAI,MAAM;QAClB;QAEA,6BAA6B;QAC7B,MAAM,UAAU,MAAM,yHAAM,CAAC,OAAO,CAAC,MAAM,CAAC;YAC1C,MAAM;gBACJ;gBACA;gBACA;gBACA,QAAQ,OAAO,EAAE;YACnB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS;YAAE,QAAQ;QAAI;IAClD,EAAE,OAAO,OAAgB;QACvB,kEAAkE;QAClE,QAAQ,KAAK,CAAC,oBAAoB;QAElC,IAAI,UAAU;QACd,IAAI,iBAAiB,OAAO;YAC1B,UAAU,MAAM,OAAO;QACzB;QAEA,IAAI,QAAQ,QAAQ,CAAC,oBAAoB;YACvC,OAAO,IAAI,gJAAY,CAAC,kCAAkC;gBACxD,QAAQ;YACV;QACF;QAEA,OAAO,IAAI,gJAAY,CAAC,CAAC,OAAO,EAAE,SAAS,EAAE;YAAE,QAAQ;QAAI;IAC7D;AACF"}}]
}